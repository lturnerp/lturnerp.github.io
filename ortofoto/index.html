<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Ortofoto-REVER</title>
    <link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyBpZD0iQ2FwYV8xIiBkYXRhLW5hbWU9IkNhcGEgMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNTIxLjYyIDUyMS42MiI+PGRlZnM+PHN0eWxlPi5jbHMtMXtmaWxsOiNhZjlhNmI7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJjbHMtMSIgZD0iTTI2MC44MSw0OTcuNTksMzczLjYsMjRINDg1LjA1TDM0MS4xOCw0OTYuODNIMTgwLjQzTDM2LjU2LDI0SDE0OFoiLz48L3N2Zz4=" />

    <!-- 1. Importación de Fuentes desde Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700&family=Saira+Condensed:wght@700&display=swap" rel="stylesheet">

    <!-- 2. Carga de Estilos (Leaflet + Plugin Local) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="plugins/leaflet.measure.css" />

    <style>
        /* 3. ESTILOS PERSONALIZADOS SEGÚN TU MANUAL DE MARCA */

        /* Variables de la Paleta de Colores */
        :root {
            --color-principal: #100F2B; /* Azul oscuro/Navy */
            --color-acento: #AF9A6B;    /* Dorado/Tan */
            --color-texto: #000000;      /* Negro */
            --color-fondo: #FFFFFF;      /* Blanco */
            --fuente-titulo: 'Saira Condensed', sans-serif;
            --fuente-texto: 'Manrope', sans-serif;
        }

        /* Reset y estilos base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: var(--fuente-texto);
            background-color: var(--color-fondo);
        }

        /* Contenedor principal de la página (Flexbox para el layout) */
        .page-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Encabezado */
        header {
            display: flex;
            /* CENTRA el contenido horizontalmente */
            justify-content: center; 
            align-items: center;
            padding: 10px 20px;
            background-color: var(--color-principal);
            color: var(--color-fondo);
            flex-shrink: 0; /* Evita que el header se encoja */
        }


        header .logo img {
            height: 40px; /* Ajusta la altura de tu logo */
            align-items: center;
        }

        /* Contenedor del mapa */
        main {
            flex-grow: 1; /* Hace que el mapa ocupe todo el espacio restante */
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Pie de página con la línea de tiempo */
        footer {
            padding: 15px 20px;
            background-color: var(--color-principal);
            text-align: center;
            flex-shrink: 0;
        }
        
        #timeline-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap; /* Para que se adapte en móviles */
        }

        .timeline-button {
            font-family: var(--fuente-texto);
            font-weight: 700;
            padding: 8px 15px;
            border: 2px solid var(--color-acento);
            background-color: transparent;
            color: var(--color-fondo);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-button:hover {
            background-color: var(--color-acento);
            color: var(--color-principal);
        }

        .timeline-button.active {
            background-color: var(--color-acento);
            color: var(--color-principal);
            font-weight: 700;
        }

        /* Compatibilidad con Móviles */
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                gap: 10px;
            }
            header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>

    <div class="page-container">
        <!-- Encabezado con título y logo -->
        <header>
            <div class="logo">
                <!-- CAMBIA 'logo.png' POR EL NOMBRE DE TU ARCHIVO DE LOGO -->
                <img src="./rever-blanco-pequeno.svg" alt="Logo de la Empresa">
            </div>
        </header>

        <!-- Contenedor principal para el mapa -->
        <main>
            <div id="map"></div>
        </main>

        <!-- Pie de página para la línea de tiempo -->
        <footer>
            <div id="timeline-container">
                <!-- Los botones de la línea de tiempo se generarán aquí con JavaScript -->
            </div>
        </footer>
    </div>


    <!-- 4. Carga de Scripts (Leaflet + Plugin Local) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="plugins/leaflet.measure.js"></script>

    <script>
        // 5. LÓGICA DE JAVASCRIPT

        // --- Configuración de las ortofotos disponibles ---
        // ¡IMPORTANTE! Edita esta sección con tus datos.
        const ortofotosDisponibles = [
            {
                fecha: "30 cm",
                ruta: './teselas/{z}/{x}/{y}.png' // Ruta a la carpeta de teselas
            },
            {
                fecha: "5.5 cm",
                ruta: './teselas_max/{z}/{x}/{y}.png'
            }
        ];

        // --- Inicialización del Mapa ---
        const map = L.map('map').setView([-23.763, -70.469], 16);
        let ortofotoActual = null; // Variable para guardar la capa de ortofoto activa

        // Capa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxNativeZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Herramienta de medición
        const measureControl = new L.Control.Measure({ position: 'topleft', primaryLengthUnit: 'meters' });
        measureControl.addTo(map);

        // --- Lógica de la Línea de Tiempo ---
        const timelineContainer = document.getElementById('timeline-container');

        // Función para cargar una ortofoto específica
        function cargarOrtofoto(ruta, botonSeleccionado) {
            // 1. Eliminar la capa anterior si existe
            if (ortofotoActual) {
                map.removeLayer(ortofotoActual);
            }
            
            // 2. Crear y añadir la nueva capa de ortofoto
            ortofotoActual = L.tileLayer(ruta, {
                minZoom: 15,
                maxZoom: 22,
                tms: false,
                attribution: 'REVER'
            }).addTo(map);
            
            // 3. Actualizar el estilo del botón activo
            document.querySelectorAll('.timeline-button').forEach(btn => {
                btn.classList.remove('active');
            });
            botonSeleccionado.classList.add('active');
        }

        // Generar los botones de la línea de tiempo dinámicamente
        ortofotosDisponibles.forEach(orto => {
            const boton = document.createElement('button');
            boton.className = 'timeline-button';
            boton.textContent = orto.fecha;
            boton.onclick = () => cargarOrtofoto(orto.ruta, boton);
            timelineContainer.appendChild(boton);
        });

        // Cargar la primera ortofoto por defecto al iniciar
        if (ortofotosDisponibles.length > 0) {
            // Seleccionamos el primer botón que acabamos de crear
            const primerBoton = timelineContainer.querySelector('.timeline-button');
            cargarOrtofoto(ortofotosDisponibles[0].ruta, primerBoton);
        }

    </script>
</body>
</html>